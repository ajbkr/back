<!doctype html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, minimal-ui, viewport-fit=cover">
    <meta name="msapplication-tap-highlight" content="no">
    <meta name="format-detection" content="telephone=no">
    <style>
body, html {
  margin: 0;
  overflow: hidden;
  padding: 0;
}
    </style>
    <title>Back to the Island</title>
  </head>
  <body>
    <canvas id="canvas">
      <p>ENOCANVAS</p>
    </canvas>
  <script>
exports={},Object.defineProperty(exports,"__esModule",{value:!0});class TouchHandler$1{constructor(t){let e={element:document.body,start:t=>{},move:t=>{},end:t=>{},width:100,height:100,left:0,top:0,sticks:[]};this.currentTouches=[],this.options=Object.assign({},e,t),this.startFn=t=>this.start(t),this.moveFn=t=>this.move(t),this.endFn=t=>this.end(t),this.bindEvents()}addStick(t){this.options.sticks.push(t)}removeStick(t){let e=this.options.sticks.indexOf(t);e>=-1&&this.options.sticks.splice(e,1)}bindEvents(){let t=this.options.element;t.addEventListener("touchstart",this.startFn,{passive:!1}),t.addEventListener("touchmove",this.moveFn,{passive:!1}),t.addEventListener("touchend",this.endFn,{passive:!1}),t.addEventListener("touchcancel",this.endFn,{passive:!1})}unbindEvents(){let t=this.options.element;t.removeEventListener("touchstart",this.startFn),t.removeEventListener("touchmove",this.moveFn),t.removeEventListener("touchend",this.endFn),t.removeEventListener("touchcancel",this.endFn)}inRange(t,e,i){let s=this.options.element.getBoundingClientRect(),h=s.width*(i.options.width/100),o=s.height*(i.options.height/100),n=s.width*(i.options.left/100),r=s.width*(i.options.top/100);return!(t<n||t>n+h)&&!(e<r||e>r+o)}findStick(t,e){let i=!1;return this.options.sticks.forEach(s=>{this.inRange(t,e,s)&&(i=s)}),i}start(t){for(let e=0;e<t.targetTouches.length;e++){let i=t.targetTouches[e];if(this.addTouchToStick(i))return t.preventDefault(),!1}}hasCurrentTouch(t){for(let e=0;e<this.currentTouches.length;e++){if(this.currentTouches[e].stick==t)return!0}return!1}addTouchToStick(t){let e=this.findStick(t.pageX,t.pageY);return!this.hasCurrentTouch(e)&&(!(!e||this.findTouch(this.currentTouches,t.identifier))&&(this.currentTouches.push({identifier:t.identifier,stick:e,x:t.pageX,y:t.pageY}),e.start(t),!0))}findTouch(t,e){for(let i=0;i<t.length;i++)if(t[i].identifier==e)return t[i];return!1}endOldTouches(t){for(let e=0;e<this.currentTouches.length;e++)this.findTouch(t,this.currentTouches[e].identifier)||(this.currentTouches[e].stick.end(),this.currentTouches.splice(e,1))}move(t){if(this.currentTouches.length)for(let e=0;e<t.changedTouches.length;e++){let i=t.changedTouches[e],s=this.findTouch(this.currentTouches,i.identifier);if(s){let e=i.pageX-s.x,h=i.pageY-s.y;return s.stick.move(e,h),s.x=i.pageX,s.y=i.pageY,t.preventDefault(),!1}}}end(t){if(this.currentTouches.length)return this.endOldTouches(t.targetTouches),t.preventDefault(),!1}}class TouchContainer{constructor(t){let e={container:document.body,width:50,height:50,left:0,top:50};this.options=Object.assign({},e,t),this.createElement()}createElement(){this.el=document.createElement("div");this.options.container.getBoundingClientRect();this.el.style.position="absolute",this.el.style.width=this.options.width+"vw",this.el.style.height=this.options.height+"vh",this.el.style.left=this.options.left+"vw",this.el.style.top=this.options.top+"vh",this.el.style.background="#999999AA"}show(){this.options.container.appendChild(this.el)}hide(){this.options.container.removeChild(this.el)}}class Stick{constructor(t){let e={"button-color":"#FF0000","track-color":"#00FF0099","button-size":12.5,"button-stroke-size":0,"track-size":15,"track-stroke-size":2,"track-stroke-color":"#FFFFFF","track-stroke-size":2,"tracking-element":document.body};this.options=Object.assign({},e,t),this._isAttached=!1,this.x=0,this.y=0,this.createCanvas()}createCanvas(){this.ratio=window.devicePixelRatio,this.canvas=document.createElement("canvas");const t=this.options["track-size"]+2*this.options["track-stroke-size"];this.canvas.width=t*this.ratio,this.canvas.height=t*this.ratio,this.canvas.style.width=t+"px",this.canvas.style.height=t+"px",this.context=this.canvas.getContext("2d")}start(t){this._isAttached&&(this.x=0,this.y=0,this.px=0,this.py=0)}getAngle(t,e){return 0==t?0:Math.atan(e/t)}getMultiplier(t){return t<0?-1:1}getAxisDelta(t){let e=this.getMultiplier(t);return t*e>.5?1*e:0}getAxis(){return{x:this.x,y:this.y,dx:this.getAxisDelta(this.x),dy:this.getAxisDelta(this.y)}}move(t,e){if(!this._isAttached)return;this.px=this.px+t,this.py=this.py+e;Math.sqrt(this.px*this.px+this.py*this.py);let i=this.getAngle(this.px,this.py),s=Math.abs(Math.cos(i)),h=Math.abs(Math.sin(i));1==s&&(h=1);let o=this.options["track-size"]/(2*this.ratio),n=Math.min(s,this.px/o),r=Math.min(h,this.py/o);this.x=Math.max(-s,n),this.y=Math.max(-h,r)}end(t){this.x=0,this.y=0}hide(){this._isAttached=!1,this.canvas.parentNode.removeChild(this.canvas)}show(){this._isAttached=!0,this.options["tracking-element"].appendChild(this.canvas)}setPosition(t,e){this.canvas.style.position="absolute";let i=this.options["track-size"]/(2*this.ratio);this.canvas.style.left=t-i+"px",this.canvas.style.top=e-i+"px"}draw(){if(!this._isAttached)return;this.context.clearRect(0,0,this.canvas.width,this.canvas.height);const t=this.options["track-size"]/2;this.drawCircle(t+this.options["track-stroke-size"],t+this.options["track-stroke-size"],t,this.options["track-color"],this.options["track-stroke-size"]*this.ratio,this.options["track-stroke-color"]);let e=(this.options["track-size"]-this.options["button-size"])/2;this.drawCircle(t+this.x*e+this.options["track-stroke-size"],t+this.y*e+this.options["track-stroke-size"],this.options["button-size"]/2,this.options["button-color"],this.options["button-stroke-size"]*this.ratio,this.options["button-stroke-color"])}drawCircle(t,e,i,s,h,o){this.context.beginPath(),this.context.arc(t,e,i,0,2*Math.PI,!1),this.context.fillStyle=s,this.context.lineWidth=h,this.context.strokeStyle=o,this.context.fill(),this.context.stroke()}}const TouchHandler=TouchHandler$1;class VirtualStick{constructor(t){const e={container:document.body,left:0,top:0,width:100,height:100,"track-size":180,"button-size":100,"button-color":"#FFFFFF99","button-stroke-color":"#FFFFFF","button-stroke-size":2,"track-color":"#00000099","track-stroke-color":"#FFFFFF","track-stroke-size":2,"touch-handler":null};this.options=Object.assign({},e,t),this.options["touch-handler"]||(this.options["touch-handler"]=new TouchHandler({element:this.options.container})),this.container=new TouchContainer,this.stick=new Stick({"tracking-element":this.options.container,"button-size":this.options["button-size"],"button-color":this.options["button-color"],"track-color":this.options["track-color"],"track-size":this.options["track-size"],"track-stroke-color":this.options["track-stroke-color"],"track-stroke-size":this.options["track-stroke-size"]}),this.options["touch-handler"].addStick(this)}start(t){this.stick.setPosition(t.pageX,t.pageY),this.stick.show(),this.stick.start()}move(t,e){this.stick.move(t,e)}end(){this.stick.hide(),this.stick.end()}draw(){this.stick.draw()}unbind(){this.options["touch-handler"].removeStick(this)}getAxis(){return this.stick.getAxis()}}exports.TouchHandler=TouchHandler,exports.VirtualStick=VirtualStick,exports.default=VirtualStick,function(){"use strict";let t,e,i={};function s(t,e){i[t]=i[t]||[],i[t].push(e)}function h(t,...e){i[t]&&i[t].map(t=>t(...e))}function o(){return t}function n(){return e}const r=()=>{};function a(){let t=o();n().clearRect(0,0,t.width,t.height)}let c={},l={},d={13:"enter",27:"esc",32:"space",37:"left",38:"up",39:"right",40:"down"};function u(t){let e=d[t.which];l[e]=!0,c[e]&&c[e](t)}function p(t){l[d[t.which]]=!1}function g(){l={}}function y(t){return!!l[t]}class m{constructor(t,e){this._x=t||0,this._y=e||0}add(t,e){return x(this.x+(t.x||0)*(e||1),this.y+(t.y||0)*(e||1))}clamp(t,e,i,s){this._c=!0,this._a=t,this._b=e,this._d=i,this._e=s}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?Math.min(Math.max(this._a,t),this._d):t}set y(t){this._y=this._c?Math.min(Math.max(this._b,t),this._e):t}}function x(t,e){return new m(t,e)}x.prototype=m.prototype,x.class=m;class w{constructor(t){this.init(t)}init(t={}){let{x:e,y:i,dx:s,dy:h,ddx:o,ddy:r,width:a,height:c,image:l}=t;this.position=x(e,i),this.velocity=x(s,h),this.acceleration=x(o,r),this.width=this.height=this.rotation=0,this.ttl=1/0,this.anchor={x:0,y:0},this.context=n();for(let e in t)this[e]=t[e];l&&(this.width=void 0!==a?a:l.width,this.height=void 0!==c?c:l.height)}get x(){return this.position.x}get y(){return this.position.y}get dx(){return this.velocity.x}get dy(){return this.velocity.y}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}get animations(){return this._a}set x(t){this.position.x=t}set y(t){this.position.y=t}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}set animations(t){let e,i;for(e in this._a={},t)this._a[e]=t[e].clone(),i=i||this._a[e];this.currentAnimation=i,this.width=this.width||i.width,this.height=this.height||i.height}isAlive(){return this.ttl>0}collidesWith(t){if(this.rotation||t.rotation)return null;let e=this.x-this.width*this.anchor.x,i=this.y-this.height*this.anchor.y,s=t.x,h=t.y;return t.anchor&&(s-=t.width*t.anchor.x,h-=t.height*t.anchor.y),e<s+t.width&&e+this.width>s&&i<h+t.height&&i+this.height>h}update(t){this.advance(t)}render(){this.draw()}playAnimation(t){this.currentAnimation=this.animations[t],this.currentAnimation.loop||this.currentAnimation.reset()}advance(t){this.velocity=this.velocity.add(this.acceleration,t),this.position=this.position.add(this.velocity,t),this.ttl--,this.currentAnimation&&this.currentAnimation.update(t)}draw(){let t=-this.width*this.anchor.x,e=-this.height*this.anchor.y;this.context.save(),this.context.translate(this.x,this.y),this.rotation&&this.context.rotate(this.rotation),this.image?this.context.drawImage(this.image,0,0,this.image.width,this.image.height,t,e,this.width,this.height):this.currentAnimation?this.currentAnimation.render({x:t,y:e,width:this.width,height:this.height,context:this.context}):(this.context.fillStyle=this.color,this.context.fillRect(t,e,this.width,this.height)),this.context.restore()}}function f(t){return new w(t)}f.prototype=w.prototype,f.class=w;const v=exports.VirtualStick,k=640,b=480,_=32,F=32,{canvas:T,context:A}=function(i){if(!(t=document.getElementById(i)||i||document.querySelector("canvas")))throw Error("You must provide a canvas element for the game");return(e=t.getContext("2d")).imageSmoothingEnabled=!1,h("init"),{canvas:t,context:e}}();T.width=k,T.height=b;const E=["#000","#00a","#0a0","#0aa","#a00","#a0a","#a50","#aaa","#555","#55f","#5f5","#5ff","#f55","#f5f","#ff5","#fff"],z={black:0,blue:1,green:2,cyan:3,red:4,magenta:5,brown:6,white:7,"light-gray":7,"dark-gray":8,"bright-black":8,"bright-blue":9,"bright-green":10,"bright-cyan":11,"bright-red":12,"bright-magenta":13,"bright-yellow":14,"bright-white":15},S=f({width:_,height:F,x:k/2,y:b/2,anchor:{x:.5,y:.5},render(){A.fillStyle=E[z.red],A.fillRect(this.x-this.anchor.x*this.width,this.y-this.anchor.y*this.height,this.width,this.height)}});let C;(()=>{const t=document.createElement("canvas");t.width=4*_,t.height=4*F;const e=t.getContext("2d");e.fillStyle=E[z.black],e.fillRect(0,0,t.width,t.height);for(let t=0;t<4;++t)for(let i=0;i<4;++i)e.fillStyle=E[4*t+i],e.fillRect(i*_,t*F,_,F);const i=new Image;i.onload=function(){C=function(t={}){let{width:e,height:i,tilewidth:s,tileheight:h,context:r=n(),tilesets:a,layers:c}=t,l=e*s,d=i*h,u=document.createElement("canvas"),p=u.getContext("2d");u.width=l,u.height=d;let g={},y={},m=Object.assign({context:r,mapwidth:l,mapheight:d,_sx:0,_sy:0,get sx(){return this._sx},get sy(){return this._sy},set sx(t){this._sx=Math.min(Math.max(0,t),l-o().width)},set sy(t){this._sy=Math.min(Math.max(0,t),d-o().height)},render(){v(u)},renderLayer(t){let e=y[t],i=g[t];e||((e=document.createElement("canvas")).width=l,e.height=d,y[t]=e,m._r(i,e.getContext("2d"))),v(e)},layerCollidesWith(t,e){let i=x(e.y),s=w(e.x),h=x(e.y+e.height),o=w(e.x+e.width),n=g[t];for(let t=i;t<=h;t++)for(let e=s;e<=o;e++)if(n.data[e+t*this.width])return!0;return!1},tileAtLayer(t,e){let i=e.row||x(e.y),s=e.col||w(e.x);return g[t]?g[t].data[s+i*m.width]:-1},setTileAtLayer(t,e,i){let s=e.row||x(e.y),h=e.col||w(e.x);g[t]&&(g[t].data[h+s*m.width]=i,f())},_r:function(t,e){e.save(),e.globalAlpha=t.opacity,t.data.map((t,i)=>{if(!t)return;let s;for(let e=m.tilesets.length-1;e>=0&&!(t/(s=m.tilesets[e]).firstgid>=1);e--);let h=s.tilewidth||m.tilewidth,o=s.tileheight||m.tileheight,n=s.margin||0,r=s.image,a=t-s.firstgid,c=s.columns||r.width/(h+n)|0,l=i%m.width*h,d=(i/m.width|0)*o,u=a%c*(h+n),p=(a/c|0)*(o+n);e.drawImage(r,u,p,h,o,l,d,h,o)}),e.restore()},layerCanvases:y},t);function x(t){return(m.sy+t)/m.tileheight|0}function w(t){return(m.sx+t)/m.tilewidth|0}function f(){m.layers&&m.layers.map(t=>{g[t.name]=t,!1!==t.visible&&m._r(t,p)})}function v(t){let{width:e,height:i}=o();m.context.drawImage(t,m.sx,m.sy,e,i,0,0,e,i)}return m.tilesets.map(e=>{let i=(window.__k?window.__k.dm.get(t):"")||window.location.href;if(e.source){if(!window.__k)throw Error('You must use "load" or "loadData" to resolve tileset.source');let t=window.__k.d[window.__k.u(e.source,i)];if(!t)throw Error(`You must load the tileset source "${e.source}" before loading the tileset`);Object.keys(t).map(i=>{e[i]=t[i]})}if(""+e.image===e.image){if(!window.__k)throw Error('You must use "load" or "loadImage" to resolve tileset.image');let t=window.__k.i[window.__k.u(e.image,i)];if(!t)throw Error(`You must load the image "${e.image}" before loading the tileset`);e.image=t}}),f(),m}({tileheight:F,tilewidth:_,width:22,height:17,tilesets:[{firstgid:1,image:i}],layers:[{name:"ground",data:[2,2,2,2,2,2,11,11,11,11,11,11,2,2,15,15,2,2,2,2,2,2,2,11,11,11,11,2,11,11,11,11,11,11,11,2,11,15,11,2,2,2,2,2,11,11,11,11,15,15,15,2,2,2,2,2,2,2,2,11,2,2,2,2,2,2,15,2,2,11,11,15,11,11,2,2,2,11,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,15,2,2,2,2,15,15,15,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,11,11,11,11,11,11,11,11,11,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,11,11,11,11,11,11,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,15,11,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,11,15,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,11,15,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2]}]}),s("move-player-west",()=>{S.x>=k/2?--S.x:C.sx>0?--C.sx:S.x>_/2&&--S.x}),s("move-player-east",()=>{S.x<k/2?++S.x:C.sx<C.tilewidth*C.width-k?++C.sx:S.x<=k-1-_/2&&++S.x}),s("move-player-north",()=>{S.y>=b/2?--S.y:C.sy>0?--C.sy:S.y>F/2&&--S.y}),s("move-player-south",()=>{S.y<b/2?++S.y:C.sy<C.tileheight*C.height-b?++C.sy:S.y<=b-1-F/2&&++S.y}),function({fps:t=60,clearCanvas:e=!0,update:i,render:s}={}){if(!i||!s)throw Error("You must provide update() and render() functions");let o,n,c,l,d,u=0,p=1e3/t,g=1/t,y=e?a:r;function m(){if(n=requestAnimationFrame(m),c=performance.now(),l=c-o,o=c,!(l>1e3)){for(h("tick"),u+=l;u>=p;)d.update(g),u-=p;y(),d.render()}}return d={update:i,render:s,isStopped:!0,start(){o=performance.now(),this.isStopped=!1,requestAnimationFrame(m)},stop(){this.isStopped=!0,cancelAnimationFrame(n)},_frame:m,set _last(t){o=t}}}({render(){A.fillStyle=E[z.black],A.fillRect(0,0,A.canvas.width,A.canvas.height),C.render(),S.render()},update(){y("left")&&h("move-player-west"),y("right")&&h("move-player-east"),y("up")&&h("move-player-north"),y("down")&&h("move-player-south");const{dx:t,dy:e}=M.getAxis();t<0?h("move-player-west"):t>0&&h("move-player-east"),e<0?h("move-player-north"):e>0&&h("move-player-south")}}).start()},i.src=t.toDataURL()})(),function(){let t;for(t=0;t<26;t++)d[65+t]=(10+t).toString(36);for(t=0;t<10;t++)d[48+t]=""+t;window.addEventListener("keydown",u),window.addEventListener("keyup",p),window.addEventListener("blur",g)}();const M=new v}();
</script>
</body>
</html>
