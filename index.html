<!doctype html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, minimal-ui, viewport-fit=cover">
    <meta name="msapplication-tap-highlight" content="no">
    <meta name="format-detection" content="telephone=no">
    <style>
body, html {
  margin: 0;
  overflow: hidden;
  padding: 0;
}
    </style>
    <title>Back to the Island</title>
  </head>
  <body>
    <canvas id="canvas">
      <p>ENOCANVAS</p>
    </canvas>
  <script>
!function(){"use strict";let t,i,e={};function h(t,...i){e[t]&&e[t].map(t=>t(...i))}function n(){return t}function s(){return i}const r=()=>{};function o(){let t=n();s().clearRect(0,0,t.width,t.height)}let a={},d={},l={13:"enter",27:"esc",32:"space",37:"left",38:"up",39:"right",40:"down"};function c(t){let i=l[t.which];d[i]=!0,a[i]&&a[i](t)}function u(t){d[l[t.which]]=!1}function g(){d={}}function w(t){return!!d[t]}class y{constructor(t,i){this._x=t||0,this._y=i||0}add(t,i){return m(this.x+(t.x||0)*(i||1),this.y+(t.y||0)*(i||1))}clamp(t,i,e,h){this._c=!0,this._a=t,this._b=i,this._d=e,this._e=h}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?Math.min(Math.max(this._a,t),this._d):t}set y(t){this._y=this._c?Math.min(Math.max(this._b,t),this._e):t}}function m(t,i){return new y(t,i)}m.prototype=y.prototype,m.class=y;class f{constructor(t){this.init(t)}init(t={}){let{x:i,y:e,dx:h,dy:n,ddx:r,ddy:o,width:a,height:d,image:l}=t;this.position=m(i,e),this.velocity=m(h,n),this.acceleration=m(r,o),this.width=this.height=this.rotation=0,this.ttl=1/0,this.anchor={x:0,y:0},this.context=s();for(let i in t)this[i]=t[i];l&&(this.width=void 0!==a?a:l.width,this.height=void 0!==d?d:l.height)}get x(){return this.position.x}get y(){return this.position.y}get dx(){return this.velocity.x}get dy(){return this.velocity.y}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}get animations(){return this._a}set x(t){this.position.x=t}set y(t){this.position.y=t}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}set animations(t){let i,e;for(i in this._a={},t)this._a[i]=t[i].clone(),e=e||this._a[i];this.currentAnimation=e,this.width=this.width||e.width,this.height=this.height||e.height}isAlive(){return this.ttl>0}collidesWith(t){if(this.rotation||t.rotation)return null;let i=this.x-this.width*this.anchor.x,e=this.y-this.height*this.anchor.y,h=t.x,n=t.y;return t.anchor&&(h-=t.width*t.anchor.x,n-=t.height*t.anchor.y),i<h+t.width&&i+this.width>h&&e<n+t.height&&e+this.height>n}update(t){this.advance(t)}render(){this.draw()}playAnimation(t){this.currentAnimation=this.animations[t],this.currentAnimation.loop||this.currentAnimation.reset()}advance(t){this.velocity=this.velocity.add(this.acceleration,t),this.position=this.position.add(this.velocity,t),this.ttl--,this.currentAnimation&&this.currentAnimation.update(t)}draw(){let t=-this.width*this.anchor.x,i=-this.height*this.anchor.y;this.context.save(),this.context.translate(this.x,this.y),this.rotation&&this.context.rotate(this.rotation),this.image?this.context.drawImage(this.image,0,0,this.image.width,this.image.height,t,i,this.width,this.height):this.currentAnimation?this.currentAnimation.render({x:t,y:i,width:this.width,height:this.height,context:this.context}):(this.context.fillStyle=this.color,this.context.fillRect(t,i,this.width,this.height)),this.context.restore()}}function x(t){return new f(t)}x.prototype=f.prototype,x.class=f;const p=640,_=480,v=32,b=32,{canvas:k,context:A}=function(e){if(!(t=document.getElementById(e)||e||document.querySelector("canvas")))throw Error("You must provide a canvas element for the game");return(i=t.getContext("2d")).imageSmoothingEnabled=!1,h("init"),{canvas:t,context:i}}();k.width=p,k.height=_;const E=["#000","#00a","#0a0","#0aa","#a00","#a0a","#a50","#aaa","#555","#55f","#5f5","#5ff","#f55","#f5f","#ff5","#fff"],S={black:0,blue:1,green:2,cyan:3,red:4,magenta:5,brown:6,white:7,"light-gray":7,"dark-gray":8,"bright-black":8,"bright-blue":9,"bright-green":10,"bright-cyan":11,"bright-red":12,"bright-magenta":13,"bright-yellow":14,"bright-white":15},M=x({width:v,height:b,x:p/2,y:_/2,anchor:{x:.5,y:.5},render(){A.fillStyle=E[S.red],A.fillRect(this.x-this.anchor.x*this.width,this.y-this.anchor.y*this.height,this.width,this.height)}});let C;(()=>{const t=document.createElement("canvas");t.width=4*v,t.height=4*b;const i=t.getContext("2d");i.fillStyle=E[S.black],i.fillRect(0,0,t.width,t.height);for(let t=0;t<4;++t)for(let e=0;e<4;++e)i.fillStyle=E[4*t+e],i.fillRect(e*v,t*b,v,b);const e=new Image;e.onload=function(){C=function(t={}){let{width:i,height:e,tilewidth:h,tileheight:r,context:o=s(),tilesets:a,layers:d}=t,l=i*h,c=e*r,u=document.createElement("canvas"),g=u.getContext("2d");u.width=l,u.height=c;let w={},y={},m=Object.assign({context:o,mapwidth:l,mapheight:c,_sx:0,_sy:0,get sx(){return this._sx},get sy(){return this._sy},set sx(t){this._sx=Math.min(Math.max(0,t),l-n().width)},set sy(t){this._sy=Math.min(Math.max(0,t),c-n().height)},render(){_(u)},renderLayer(t){let i=y[t],e=w[t];i||((i=document.createElement("canvas")).width=l,i.height=c,y[t]=i,m._r(e,i.getContext("2d"))),_(i)},layerCollidesWith(t,i){let e=f(i.y),h=x(i.x),n=f(i.y+i.height),s=x(i.x+i.width),r=w[t];for(let t=e;t<=n;t++)for(let i=h;i<=s;i++)if(r.data[i+t*this.width])return!0;return!1},tileAtLayer(t,i){let e=i.row||f(i.y),h=i.col||x(i.x);return w[t]?w[t].data[h+e*m.width]:-1},setTileAtLayer(t,i,e){let h=i.row||f(i.y),n=i.col||x(i.x);w[t]&&(w[t].data[n+h*m.width]=e,p())},_r:function(t,i){i.save(),i.globalAlpha=t.opacity,t.data.map((t,e)=>{if(!t)return;let h;for(let i=m.tilesets.length-1;i>=0&&!(t/(h=m.tilesets[i]).firstgid>=1);i--);let n=h.tilewidth||m.tilewidth,s=h.tileheight||m.tileheight,r=h.margin||0,o=h.image,a=t-h.firstgid,d=h.columns||o.width/(n+r)|0,l=e%m.width*n,c=(e/m.width|0)*s,u=a%d*(n+r),g=(a/d|0)*(s+r);i.drawImage(o,u,g,n,s,l,c,n,s)}),i.restore()},layerCanvases:y},t);function f(t){return(m.sy+t)/m.tileheight|0}function x(t){return(m.sx+t)/m.tilewidth|0}function p(){m.layers&&m.layers.map(t=>{w[t.name]=t,!1!==t.visible&&m._r(t,g)})}function _(t){let{width:i,height:e}=n();m.context.drawImage(t,m.sx,m.sy,i,e,0,0,i,e)}return m.tilesets.map(i=>{let e=(window.__k?window.__k.dm.get(t):"")||window.location.href;if(i.source){if(!window.__k)throw Error('You must use "load" or "loadData" to resolve tileset.source');let t=window.__k.d[window.__k.u(i.source,e)];if(!t)throw Error(`You must load the tileset source "${i.source}" before loading the tileset`);Object.keys(t).map(e=>{i[e]=t[e]})}if(""+i.image===i.image){if(!window.__k)throw Error('You must use "load" or "loadImage" to resolve tileset.image');let t=window.__k.i[window.__k.u(i.image,e)];if(!t)throw Error(`You must load the image "${i.image}" before loading the tileset`);i.image=t}}),p(),m}({tileheight:b,tilewidth:v,width:22,height:17,tilesets:[{firstgid:1,image:e}],layers:[{name:"ground",data:[2,2,2,2,2,2,11,11,11,11,11,11,2,2,15,15,2,2,2,2,2,2,2,11,11,11,11,2,11,11,11,11,11,11,11,2,11,15,11,2,2,2,2,2,11,11,11,11,15,15,15,2,2,2,2,2,2,2,2,11,2,2,2,2,2,2,15,2,2,11,11,15,11,11,2,2,2,11,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,15,2,2,2,2,15,15,15,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,11,11,11,11,11,11,11,11,11,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,11,11,11,11,11,11,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,15,11,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,11,15,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,11,15,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2]}]}),function({fps:t=60,clearCanvas:i=!0,update:e,render:n}={}){if(!e||!n)throw Error("You must provide update() and render() functions");let s,a,d,l,c,u=0,g=1e3/t,w=1/t,y=i?o:r;function m(){if(a=requestAnimationFrame(m),d=performance.now(),l=d-s,s=d,!(l>1e3)){for(h("tick"),u+=l;u>=g;)c.update(w),u-=g;y(),c.render()}}return c={update:e,render:n,isStopped:!0,start(){s=performance.now(),this.isStopped=!1,requestAnimationFrame(m)},stop(){this.isStopped=!0,cancelAnimationFrame(a)},_frame:m,set _last(t){s=t}}}({render(){A.fillStyle=E[S.black],A.fillRect(0,0,A.canvas.width,A.canvas.height),C.render(),M.render()},update(){w("left")&&(M.x>=p/2?--M.x:C.sx>0?--C.sx:M.x>v/2&&--M.x),w("right")&&(M.x<p/2?++M.x:C.sx<C.tilewidth*C.width-p?++C.sx:M.x<=p-1-v/2&&++M.x),w("up")&&(M.y>=_/2?--M.y:C.sy>0?--C.sy:M.y>b/2&&--M.y),w("down")&&(M.y<_/2?++M.y:C.sy<C.tileheight*C.height-_?++C.sy:M.y<=_-1-b/2&&++M.y)}}).start()},e.src=t.toDataURL()})(),function(){let t;for(t=0;t<26;t++)l[65+t]=(10+t).toString(36);for(t=0;t<10;t++)l[48+t]=""+t;window.addEventListener("keydown",c),window.addEventListener("keyup",u),window.addEventListener("blur",g)}()}();
</script>
</body>
</html>
