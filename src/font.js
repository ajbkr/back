import { Sprite } from 'kontra'

import { c, palette } from './palette'

const CHARACTER_WIDTH = 4
const CHARACTER_HEIGHT = 6

// https://robey.lag.net/2010/01/23/tiny-monospace-font.html
const font = [
  [
    // SPACE
    //
    // 0000
    // 0000
    // 0000
    // 0000
    // 0000
    // 0000
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00
  ],
  [
    // !
    //
    // 0100
    // 0100
    // 0100
    // 0000
    // 0100
    // 0000
    0x04,
    0x04,
    0x04,
    0x00,
    0x04,
    0x00
  ],
  [
    // "
    //
    // 1010
    // 1010
    // 0000
    // 0000
    // 0000
    // 0000
    0x0a,
    0x0a,
    0x00,
    0x00,
    0x00,
    0x00
  ],
  [
    // #
    //
    // 1010
    // 1110
    // 1010
    // 1110
    // 1010
    // 0000
    0x0a,
    0x0e,
    0x0a,
    0x0e,
    0x0a,
    0x00
  ],
  [
    // $
    //
    // 0110
    // 1100
    // 0110
    // 1100
    // 0100
    // 0000
    0x06,
    0x0c,
    0x06,
    0x0c,
    0x04,
    0x00
  ],
  [
    // %
    //
    // 1000
    // 0010
    // 0100
    // 1000
    // 0010
    // 0000
    0x08,
    0x02,
    0x04,
    0x08,
    0x02,
    0x00
  ],
  [
    // &
    //
    // 1100
    // 1100
    // 1110
    // 1010
    // 0110
    // 0000
    0x0c,
    0x0c,
    0x0e,
    0x0a,
    0x06,
    0x00
  ],
  [
    // '
    //
    // 0100
    // 0100
    // 0000
    // 0000
    // 0000
    // 0000
    0x04,
    0x04,
    0x00,
    0x00,
    0x00,
    0x00
  ],
  [
    // (
    //
    // 0010
    // 0100
    // 0100
    // 0100
    // 0010
    // 0000
    0x02,
    0x04,
    0x04,
    0x04,
    0x02,
    0x00
  ],
  [
    // )
    //
    // 1000
    // 0100
    // 0100
    // 0100
    // 1000
    // 0000
    0x08,
    0x04,
    0x04,
    0x04,
    0x08,
    0x00
  ],
  [
    // *
    //
    // 1010
    // 0100
    // 1010
    // 0000
    // 0000
    // 0000
    0x0a,
    0x04,
    0x0a,
    0x00,
    0x00,
    0x00
  ],
  [
    // +
    //
    // 0000
    // 0100
    // 1110
    // 0100
    // 0000
    // 0000
    0x00,
    0x04,
    0x0e,
    0x04,
    0x00,
    0x00
  ],
  [
    // ,
    //
    // 0000
    // 0000
    // 0000
    // 0100
    // 1000
    // 0000
    0x00,
    0x00,
    0x00,
    0x04,
    0x08,
    0x00
  ],
  [
    // -
    //
    // 0000
    // 0000
    // 1110
    // 0000
    // 0000
    // 0000
    0x00,
    0x00,
    0x0e,
    0x00,
    0x00,
    0x00
  ],
  [
    // .
    //
    // 0000
    // 0000
    // 0000
    // 0000
    // 0100
    // 0000
    0x00,
    0x00,
    0x00,
    0x00,
    0x04,
    0x00
  ],
  [
    // /
    //
    // 0010
    // 0010
    // 0100
    // 1000
    // 1000
    // 0000
    0x02,
    0x02,
    0x04,
    0x08,
    0x08,
    0x00
  ],
  [
    // 0
    //
    // 0110
    // 1010
    // 1010
    // 1010
    // 1100
    // 0000
    0x06,
    0x0a,
    0x0a,
    0x0a,
    0x0c,
    0x00
  ],
  [
    // 1
    //
    // 0100
    // 1100
    // 0100
    // 0100
    // 0100
    // 0000
    0x04,
    0x0c,
    0x04,
    0x04,
    0x04,
    0x00
  ],
  [
    // 2
    //
    // 1100
    // 0010
    // 0100
    // 1000
    // 1110
    // 0000
    0x0c,
    0x02,
    0x04,
    0x08,
    0x0e,
    0x00
  ],
  [
    // 3
    //
    // 1100
    // 0010
    // 0100
    // 0010
    // 1100
    // 0000
    0x0c,
    0x02,
    0x04,
    0x02,
    0x0c,
    0x00
  ],
  [
    // 4
    //
    // 1010
    // 1010
    // 1110
    // 0010
    // 0010
    // 0000
    0x0a,
    0x0a,
    0x0e,
    0x02,
    0x02,
    0x00
  ],
  [
    // 5
    //
    // 1110
    // 1000
    // 1100
    // 0010
    // 1100
    // 0000
    0x0e,
    0x08,
    0x0c,
    0x02,
    0x0c,
    0x00
  ],
  [
    // 6
    //
    // 0110
    // 1000
    // 1110
    // 1010
    // 1110
    // 0000
    0x06,
    0x08,
    0x0e,
    0x0a,
    0x0e,
    0x00
  ],
  [
    // 7
    //
    // 1110
    // 0010
    // 0100
    // 1000
    // 1000
    // 0000
    0x0e,
    0x02,
    0x04,
    0x08,
    0x08,
    0x00
  ],
  [
    // 8
    //
    // 1110
    // 1010
    // 1110
    // 1010
    // 1110
    // 0000
    0x0e,
    0x0a,
    0x0e,
    0x0a,
    0x0e,
    0x00
  ],
  [
    // 9
    //
    // 1110
    // 1010
    // 1110
    // 0010
    // 1100
    // 0000
    0x0e,
    0x0a,
    0x0e,
    0x02,
    0x0c,
    0x00
  ],
  [
    // :
    //
    // 0000
    // 0100
    // 0000
    // 0100
    // 0000
    // 0000
    0x00,
    0x04,
    0x00,
    0x04,
    0x00,
    0x00
  ],
  [
    // ;
    //
    // 0000
    // 0100
    // 0000
    // 0100
    // 1000
    // 0000
    0x00,
    0x04,
    0x00,
    0x04,
    0x08,
    0x00
  ],
  [
    // <
    //
    // 0010
    // 0100
    // 1000
    // 0100
    // 0010
    // 0000
    0x02,
    0x04,
    0x08,
    0x04,
    0x02,
    0x00
  ],
  [
    // =
    //
    // 0000
    // 1110
    // 0000
    // 1110
    // 0000
    // 0000
    0x00,
    0x0e,
    0x00,
    0x0e,
    0x00,
    0x00
  ],
  [
    // >
    //
    // 1000
    // 0100
    // 0010
    // 0100
    // 1000
    // 0000
    0x08,
    0x04,
    0x02,
    0x04,
    0x08,
    0x00
  ],
  [
    // ?
    //
    // 1110
    // 0010
    // 0100
    // 0000
    // 0100
    // 0000
    0x0e,
    0x02,
    0x04,
    0x00,
    0x04,
    0x00
  ],
  [
    // @
    //
    // 0100
    // 1010
    // 1110
    // 1000
    // 0110
    // 0000
    0x04,
    0x0a,
    0x0e,
    0x08,
    0x06,
    0x00
  ],
  [
    // A
    //
    // 0100
    // 1010
    // 1110
    // 1010
    // 1010
    // 0000
    0x04,
    0x0a,
    0x0e,
    0x0a,
    0x0a,
    0x00
  ],
  [
    // B
    //
    // 1100
    // 1010
    // 1100
    // 1010
    // 1100
    // 0000
    0x0c,
    0x0a,
    0x0c,
    0x0a,
    0x0c,
    0x00
  ],
  [
    // C
    //
    // 0110
    // 1000
    // 1000
    // 1000
    // 0110
    // 0000
    0x06,
    0x08,
    0x08,
    0x08,
    0x06,
    0x00
  ],
  [
    // D
    //
    // 1100
    // 1010
    // 1010
    // 1010
    // 1100
    // 0000
    0x0c,
    0x0a,
    0x0a,
    0x0a,
    0x0c,
    0x00
  ],
  [
    // E
    //
    // 1110
    // 1000
    // 1110
    // 1000
    // 1110
    // 0000
    0x0e,
    0x08,
    0x0e,
    0x08,
    0x0e,
    0x00
  ],
  [
    // F
    //
    // 1110
    // 1000
    // 1110
    // 1000
    // 1000
    // 0000
    0x0e,
    0x08,
    0x0e,
    0x08,
    0x08,
    0x00
  ],
  [
    // G
    //
    // 0110
    // 1000
    // 1110
    // 1010
    // 0110
    // 0000
    0x06,
    0x08,
    0x0e,
    0x0a,
    0x06,
    0x00
  ],
  [
    // H
    //
    // 1010
    // 1010
    // 1110
    // 1010
    // 1010
    // 0000
    0x0a,
    0x0a,
    0x0e,
    0x0a,
    0x0a,
    0x00
  ],
  [
    // I
    //
    // 1110
    // 0100
    // 0100
    // 0100
    // 1110
    // 0000
    0x0e,
    0x04,
    0x04,
    0x04,
    0x0e,
    0x00
  ],
  [
    // J
    //
    // 0010
    // 0010
    // 0010
    // 1010
    // 0100
    // 0000
    0x02,
    0x02,
    0x02,
    0x0a,
    0x04,
    0x00
  ],
  [
    // K
    //
    // 1010
    // 1010
    // 1100
    // 1010
    // 1010
    // 0000
    0x0a,
    0x0a,
    0x0c,
    0x0a,
    0x0a,
    0x00
  ],
  [
    // L
    //
    // 1000
    // 1000
    // 1000
    // 1000
    // 1110
    // 0000
    0x08,
    0x08,
    0x08,
    0x08,
    0x0f,
    0x00
  ],
  [
    // M
    //
    // 1010
    // 1110
    // 1110
    // 1010
    // 1010
    // 0000
    0x0a,
    0x0e,
    0x0e,
    0x0a,
    0x0a,
    0x00
  ],
  [
    // N
    //
    // 1010
    // 1110
    // 1110
    // 1110
    // 1010
    // 0000
    0x0a,
    0x0e,
    0x0e,
    0x0e,
    0x0a,
    0x00
  ],
  [
    // O
    //
    // 0100
    // 1010
    // 1010
    // 1010
    // 0100
    // 0000
    0x04,
    0x0a,
    0x0a,
    0x0a,
    0x04,
    0x00
  ],
  [
    // P
    //
    // 1100
    // 1010
    // 1100
    // 1000
    // 1000
    // 0000
    0x0c,
    0x0a,
    0x0c,
    0x08,
    0x08,
    0x00
  ],
  [
    // Q
    //
    // 0100
    // 1010
    // 1010
    // 1110
    // 0110
    // 0000
    0x04,
    0x0a,
    0x0a,
    0x0e,
    0x06,
    0x00
  ],
  [
    // R
    //
    // 1100
    // 1010
    // 1110
    // 1100
    // 1010
    // 0000
    0x0c,
    0x0a,
    0x0e,
    0x0c,
    0x0a,
    0x00
  ],
  [
    // S
    //
    // 0110
    // 1000
    // 0100
    // 0010
    // 1100
    // 0000
    0x06,
    0x08,
    0x04,
    0x02,
    0x0c,
    0x00
  ],
  [
    // T
    //
    // 1110
    // 0100
    // 0100
    // 0100
    // 0100
    // 0000
    0x0e,
    0x04,
    0x04,
    0x04,
    0x04,
    0x00
  ],
  [
    // U
    //
    // 1010
    // 1010
    // 1010
    // 1010
    // 0110
    // 0000
    0x0a,
    0x0a,
    0x0a,
    0x0a,
    0x06,
    0x00
  ],
  [
    // V
    //
    // 1010
    // 1010
    // 1010
    // 0100
    // 0100
    // 0000
    0x0a,
    0x0a,
    0x0a,
    0x04,
    0x04,
    0x00
  ],
  [
    // W
    //
    // 1010
    // 1010
    // 1110
    // 1110
    // 1010
    // 0000
    0x0a,
    0x0a,
    0x0e,
    0x0e,
    0x0a,
    0x00
  ],
  [
    // X
    //
    // 1010
    // 1010
    // 0100
    // 1010
    // 1010
    // 0000
    0x0a,
    0x0a,
    0x04,
    0x0a,
    0x0a,
    0x00
  ],
  [
    // Y
    //
    // 1010
    // 1010
    // 0100
    // 0100
    // 0100
    // 0000
    0x0a,
    0x0a,
    0x04,
    0x04,
    0x04,
    0x00
  ],
  [
    // Z
    //
    // 1110
    // 0010
    // 0100
    // 1000
    // 1110
    // 0000
    0x0e,
    0x02,
    0x04,
    0x08,
    0x0e,
    0x00
  ],
  [
    // [
    //
    // 1110
    // 1000
    // 1000
    // 1000
    // 1110
    // 0000
    0x0e,
    0x08,
    0x08,
    0x08,
    0x0e,
    0x00
  ],
  [
    // \
    //
    // 0000
    // 1000
    // 0100
    // 0010
    // 0000
    // 0000
    0x00,
    0x08,
    0x04,
    0x02,
    0x00,
    0x00
  ],
  [
    // ]
    //
    // 1110
    // 0010
    // 0010
    // 0010
    // 1110
    // 0000
    0x0e,
    0x02,
    0x02,
    0x02,
    0x0e,
    0x00
  ],
  [
    // ^
    //
    // 0100
    // 1010
    // 0000
    // 0000
    // 0000
    // 0000
    0x04,
    0x0a,
    0x00,
    0x00,
    0x00,
    0x00
  ],
  [
    // _
    //
    // 0000
    // 0000
    // 0000
    // 0000
    // 1110
    // 0000
    0x00,
    0x00,
    0x00,
    0x00,
    0x0e,
    0x00
  ]
]

function makeFontSprite () {
  const canvas = document.createElement('canvas')

  canvas.width = font.length * CHARACTER_WIDTH
  canvas.height = CHARACTER_HEIGHT

  const context = canvas.getContext('2d')

  font.forEach((character, index) => {
    for (let y = 0; y < CHARACTER_HEIGHT; ++y) {
      let mask = 0x08

      for (let x = 0; x < CHARACTER_WIDTH; ++x, mask >>= 1) {
        const bit = character[y] & mask

        const color = bit ? palette[c['bright-white']] : palette[c.black]

        context.fillStyle = color
        context.fillRect(index * CHARACTER_WIDTH + x, y, 1, 1)
      }
    }
  })

  return Sprite({
    width: canvas.width,
    height: canvas.height,

    x: 0,
    y: 0,

    image: canvas,

    outputCharacterXY (x, y, character) {
      const sx = (character.charCodeAt(0) - ' '.charCodeAt(0)) * CHARACTER_WIDTH

      this.context.drawImage(this.image,
        sx, 0, CHARACTER_WIDTH, CHARACTER_HEIGHT,
        x, y, CHARACTER_WIDTH, CHARACTER_HEIGHT
      )
    },

    outputText (text) {
      text.split('').forEach((character, index) => {
        this.outputCharacterXY(this.x + index * CHARACTER_WIDTH, this.y, character)
      })
    }
  })
}

export {
  makeFontSprite
}
